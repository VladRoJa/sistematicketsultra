<!-- frontend-angular/src/app/pantalla-crear-ticket/crear-ticket-refactor.component.html -->

<mat-card class="crear-ticket-card">
  <h2 class="titulo-formulario">
    <span style="font-size: 1.3em;">游꿞</span> Crear Nuevo Ticket
  </h2>

  <form [formGroup]="form" (ngSubmit)="enviar()">

    <!-- Campos din치micos (departamento, categor칤a, subcat, etc) -->
    <ng-container *ngFor="let nivel of niveles">
      <mat-form-field appearance="fill" class="w-full" *ngIf="nivel.opciones.length">
        <mat-label>{{ nivel.etiqueta }}*</mat-label>
        <mat-select [formControl]="nivel.control" [disabled]="nivel.loading">
          <mat-option *ngFor="let op of nivel.opciones" [value]="op.id">
            {{ op.nombre }}
          </mat-option>
        </mat-select>
        <mat-progress-spinner
          *ngIf="nivel.loading"
          mode="indeterminate"
          diameter="20"
          style="position: absolute; top: 15px; right: 20px;"
        ></mat-progress-spinner>
        <mat-error *ngIf="nivel.control.touched && nivel.control.invalid">
          Selecciona {{ nivel.etiqueta.toLowerCase() }}
        </mat-error>
      </mat-form-field>
    </ng-container>

    <!-- Descripci칩n -->
    <mat-form-field appearance="fill" class="w-full">
      <mat-label>Descripci칩n del problema*</mat-label>
      <textarea matInput formControlName="descripcion" rows="3"></textarea>
      <mat-error *ngIf="form.get('descripcion')?.touched && form.get('descripcion')?.invalid">
        Escribe una descripci칩n
      </mat-error>
    </mat-form-field>

    <!-- Criticidad -->
    <mat-form-field appearance="fill" class="w-full">
      <mat-label>Nivel de criticidad*</mat-label>
      <mat-select formControlName="criticidad">
        <mat-option *ngFor="let n of [1,2,3,4,5]" [value]="n">Nivel {{ n }}</mat-option>
      </mat-select>
      <mat-error *ngIf="form.get('criticidad')?.touched && form.get('criticidad')?.invalid">
        Selecciona criticidad
      </mat-error>
    </mat-form-field>

    <button
      mat-raised-button
      color="primary"
      class="w-full mt-3"
      [disabled]="form.invalid || loadingGuardar"
      type="submit"
    >
      <ng-container *ngIf="!loadingGuardar; else loading">
        Crear ticket
      </ng-container>
      <ng-template #loading>
        <mat-progress-spinner
          diameter="20"
          mode="indeterminate"
          color="primary"
          style="display: inline-block; vertical-align: middle;"
        ></mat-progress-spinner>
      </ng-template>
    </button>
  </form>
</mat-card>
