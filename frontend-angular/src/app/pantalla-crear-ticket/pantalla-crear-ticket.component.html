<div class="ticket-container-global">
  <h2>🎫 Crear Nuevo Ticket</h2>

  <!-- Formulario principal -->
  <form [formGroup]="formularioCrearTicket" (ngSubmit)="enviarTicket()" class="formulario-ticket-container">

    <!-- Departamento -->
    <div class="form-group">
      <label for="departamento">🏢 Departamento:</label>
      <select id="departamento" formControlName="departamento">
        <option [ngValue]="null">Selecciona un departamento</option>
        <option *ngFor="let dep of departamentos" [ngValue]="dep.id">{{ dep.nombre }}</option>
      </select>
    </div>

    <!-- Tipo de Mantenimiento (solo si es Mantenimiento) -->
    <div *ngIf="formularioCrearTicket.get('departamento')?.value === 1" class="form-group">
      <label for="tipoMantenimiento">⚙️ Tipo de mantenimiento:</label>
      <select id="tipoMantenimiento" formControlName="tipoMantenimiento">
        <option [ngValue]="null">Selecciona uno</option>
        <option value="edificio">🏢 Edificio</option>
        <option value="aparatos">🏋️ Aparatos</option>
      </select>
    </div>

    <!-- Subformularios: los hijos solo manejan campos, pero no el submit -->
    <div class="formulario-sub">
      <app-mantenimiento-edificio
        *ngIf="formularioCrearTicket.get('departamento')?.value === 1 && formularioCrearTicket.get('tipoMantenimiento')?.value === 'edificio'"
        [parentForm]="formularioCrearTicket">
      </app-mantenimiento-edificio>

      <app-mantenimiento-aparatos
        *ngIf="formularioCrearTicket.get('departamento')?.value === 1 && formularioCrearTicket.get('tipoMantenimiento')?.value === 'aparatos'"
        [parentForm]="formularioCrearTicket">
      </app-mantenimiento-aparatos>

      <app-finanzas *ngIf="formularioCrearTicket.get('departamento')?.value === 2" [parentForm]="formularioCrearTicket"></app-finanzas>
      <app-marketing *ngIf="formularioCrearTicket.get('departamento')?.value === 3" [parentForm]="formularioCrearTicket"></app-marketing>
      <app-gerencia-deportiva *ngIf="formularioCrearTicket.get('departamento')?.value === 4" [parentForm]="formularioCrearTicket"></app-gerencia-deportiva>
      <app-recursos-humanos *ngIf="formularioCrearTicket.get('departamento')?.value === 5" [parentForm]="formularioCrearTicket"></app-recursos-humanos>
      <app-compras *ngIf="formularioCrearTicket.get('departamento')?.value === 6" [parentForm]="formularioCrearTicket"></app-compras>
      <app-sistemas *ngIf="formularioCrearTicket.get('departamento')?.value === 7" [parentForm]="formularioCrearTicket"></app-sistemas>
    </div>

    <!-- 🔥 Este es el botón global -->
    <button type="submit" class="btn-submit">📩 Crear Ticket</button>
  </form>

  <p *ngIf="mensaje" class="mensaje">{{ mensaje }}</p>
</div>
