<!-- frontend-angular\src\app\pantalla-crear-ticket\pantalla-crear-ticket.component.html -->

<mat-card class="ticket-container-global">
  <h2>🎫 Crear Nuevo Ticket</h2>

  <form [formGroup]="formularioCrearTicket" (ngSubmit)="enviarTicket()" class="formulario-ticket-container">

    <!-- Departamento -->
    <mat-form-field appearance="fill">
      <mat-label>🏢 Departamento</mat-label>
      <mat-select formControlName="departamento">
        <mat-option [value]="null">Selecciona un departamento</mat-option>
        <mat-option *ngFor="let dep of departamentos" [value]="dep.id">{{ dep.nombre }}</mat-option>
      </mat-select>
    </mat-form-field>

    <!-- Tipo de Mantenimiento (solo si es Mantenimiento) -->
    <mat-form-field appearance="fill" *ngIf="formularioCrearTicket.get('departamento')?.value === 1">
      <mat-label>⚙️ Tipo de mantenimiento</mat-label>
      <mat-select formControlName="tipoMantenimiento" (selectionChange)="onTipoMantenimientoChange($event.value)">
        <mat-option [value]="null">Selecciona uno</mat-option>
        <mat-option value="edificio">🏢 Edificio</mat-option>
        <mat-option value="aparatos">🏋️ Aparatos</mat-option>
      </mat-select>
    </mat-form-field>

    <!-- Jerarquía dinámica: ultra pro -->
    <ng-container *ngIf="mostrarJerarquiaDinamica">
      <app-formulario-dinamico-clasificacion
        [parentForm]="formularioCrearTicket"
        [catalogoPlano]="clasificacionPlanoDepto"
        [loading]="loadingClasificacion">
      </app-formulario-dinamico-clasificacion>
    </ng-container>

    <!-- Nivel de criticidad -->
    <mat-form-field appearance="fill">
      <mat-label>🔥 Nivel de criticidad</mat-label>
      <mat-select formControlName="criticidad">
        <mat-option *ngFor="let nivel of [1,2,3,4,5]" [value]="nivel">
          Nivel {{ nivel }}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <!-- Campo descripción, sugerido debajo de jerarquía -->
    <mat-form-field appearance="fill" class="w-full" *ngIf="mostrarJerarquiaDinamica">
      <mat-label>📝 Descripción del problema</mat-label>
      <textarea
        matInput
        formControlName="descripcion"
        rows="4"
        placeholder="Detalla lo ocurrido con claridad..."></textarea>
    </mat-form-field>

    <button mat-raised-button color="primary" type="submit" class="btn-submit" [disabled]="formularioCrearTicket.invalid || loadingClasificacion">
      <mat-icon>send</mat-icon> Crear Ticket
    </button>
  </form>

  <p *ngIf="mensaje" class="mensaje">{{ mensaje }}</p>
</mat-card>
