<!-- pantalla-crear-ticket.component.html -->

<div class="container">
  <h2>🎫 Crear Nuevo Ticket</h2>

  <!-- Formulario principal reactivo solo para el selector de departamento -->
  <form [formGroup]="formularioMantenimiento">

    <!-- 🌐 Selector de Departamento -->
    <div class="form-group">
      <label for="departamento">🏢 Departamento:</label>
      <select id="departamento" formControlName="departamento">
        <option [ngValue]="null">Selecciona un departamento</option>
        <option *ngFor="let dep of departamentos" [ngValue]="dep.id">{{ dep.nombre }}</option>
      </select>
    </div>
  </form>

  <!-- ⚙️ SUBFORMULARIOS POR DEPARTAMENTO -->

  <!-- Mantenimiento -->
  <div *ngIf="formularioMantenimiento.get('departamento')?.value === 1" class="form-mantenimiento-box">
    <label for="tipoMantenimiento">⚙️ Tipo de mantenimiento:</label>
    <select id="tipoMantenimiento" formControlName="tipoMantenimiento">
      <option [ngValue]="null">Selecciona uno</option>
      <option value="edificio">🏢 Edificio</option>
      <option value="aparatos">🏋️ Aparatos</option>
    </select>

    <div class="form-mantenimiento-subform">
      <app-mantenimiento-edificio
        *ngIf="formularioMantenimiento.get('tipoMantenimiento')?.value === 'edificio'"
        [parentForm]="formularioMantenimiento"
        (formularioValido)="recibirPayloadDesdeFormulario($event)">
      </app-mantenimiento-edificio>

      <app-mantenimiento-aparatos
        *ngIf="formularioMantenimiento.get('tipoMantenimiento')?.value === 'aparatos'"
        [parentForm]="formularioMantenimiento"
        (formularioValido)="recibirPayloadDesdeFormulario($event)">
      </app-mantenimiento-aparatos>
    </div>
  </div>

  <!-- Finanzas -->
  <app-finanzas
    *ngIf="formularioMantenimiento.get('departamento')?.value === 2"
    (formularioValido)="recibirPayloadDesdeFormulario($event)">
  </app-finanzas>

  <!-- Marketing -->
  <app-marketing
    *ngIf="formularioMantenimiento.get('departamento')?.value === 3"
    (formularioValido)="recibirPayloadDesdeFormulario($event)">
  </app-marketing>

  <!-- Gerencia Deportiva -->
  <app-gerencia-deportiva
    *ngIf="formularioMantenimiento.get('departamento')?.value === 4"
    (formularioValido)="recibirPayloadDesdeFormulario($event)">
  </app-gerencia-deportiva>

  <!-- Recursos Humanos -->
  <app-recursos-humanos
    *ngIf="formularioMantenimiento.get('departamento')?.value === 5"
    (formularioValido)="recibirPayloadDesdeFormulario($event)">
  </app-recursos-humanos>

  <!-- Compras -->
  <app-compras
    *ngIf="formularioMantenimiento.get('departamento')?.value === 6"
    (formularioValido)="recibirPayloadDesdeFormulario($event)">
  </app-compras>

  <!-- Sistemas -->
  <app-sistemas
    *ngIf="formularioMantenimiento.get('departamento')?.value === 7"
    (formularioValido)="recibirPayloadDesdeFormulario($event)">
  </app-sistemas>

  <!-- ✅ Mensaje de validación o éxito -->
  <p *ngIf="mensaje" class="mensaje">{{ mensaje }}</p>
</div>
